import { useState, useEffect, useCallback } from "react";
import { onAuthChange, registerWithEmail, loginWithEmail, loginWithGoogle, logoutUser, getCurrentUid, checkUsernameAvailable, createUserProfile, getUserProfile, updateUserProfile, shareAdventure, getPosts, toggleLikePost, addCommentToPost, getComments, deleteComment, deletePost } from "./firebase";
const storage={get:(k)=>{try{const v=localStorage.getItem(k);return v?JSON.parse(v):null}catch{return null}},set:(k,v)=>{try{localStorage.setItem(k,JSON.stringify(v))}catch{}}};
const CATEGORIES=[{id:"explore",label:"KeÅŸif",emoji:"ğŸ§­",color:"#FF6B35"},{id:"social",label:"Sosyal",emoji:"ğŸ‘‹",color:"#4ECDC4"},{id:"creative",label:"YaratÄ±cÄ±",emoji:"ğŸ¨",color:"#A855F7"},{id:"mindful",label:"FarkÄ±ndalÄ±k",emoji:"ğŸ§˜",color:"#06B6D4"},{id:"food",label:"Lezzet",emoji:"ğŸ³",color:"#F59E0B"},{id:"fitness",label:"Hareket",emoji:"ğŸƒ",color:"#EF4444"}];
const DIFFICULTY_LEVELS=[{id:"easy",label:"Kolay",emoji:"ğŸŒ±",desc:"Konfor alanÄ±nda"},{id:"medium",label:"Cesur",emoji:"âš¡",desc:"Biraz zorlayÄ±cÄ±"},{id:"hard",label:"Ã‡Ä±lgÄ±n",emoji:"ğŸ”¥",desc:"SÄ±nÄ±rlarÄ± zorla"}];
const ENVIRONMENTS=[{id:"home",label:"Evde",emoji:"ğŸ ",desc:"Evden Ã§Ä±kmadan"},{id:"outdoor",label:"DÄ±ÅŸarÄ±da",emoji:"ğŸŒ³",desc:"Sokak, park, doÄŸa"},{id:"place",label:"Mekanda",emoji:"ğŸ›ï¸",desc:"Kafe, mÃ¼ze, Ã§arÅŸÄ±"},{id:"any",label:"Fark etmez",emoji:"ğŸ²",desc:"SÃ¼rpriz olsun"}];
const BADGES=[{id:"first",name:"Ä°lk AdÄ±m",emoji:"ğŸ‘£",req:1},{id:"five",name:"BeÅŸli",emoji:"â­",req:5},{id:"ten",name:"On Numara",emoji:"ğŸ…",req:10},{id:"twenty",name:"Yirmi Devrim",emoji:"ğŸ¯",req:20},{id:"month",name:"Ay YÄ±ldÄ±zÄ±",emoji:"ğŸŒ™",req:30},{id:"fifty",name:"Efsane KaÅŸif",emoji:"ğŸ‘‘",req:50},{id:"streak3",name:"3 GÃ¼n Serisi",emoji:"ğŸ”¥",req:"streak3"},{id:"streak7",name:"7 GÃ¼n Serisi",emoji:"ğŸ’",req:"streak7"},{id:"streak14",name:"14 GÃ¼n Serisi",emoji:"ğŸ†",req:"streak14"},{id:"allcat",name:"Her Åeyci",emoji:"ğŸŒˆ",req:"allcat"},{id:"location",name:"Gezgin",emoji:"ğŸ“",req:"location"}];
const DEFAULT_STATE={interests:[],difficulty:"easy",xp:0,level:1,streak:0,bestStreak:0,completedAdventures:[],lastCompletedDate:null,todayAdventure:null,todayDate:null,onboarded:false,locationEnabled:false,city:null,lat:null,lon:null,nearbyPlaces:[],locationAdventureCount:0,skipsToday:0};
function getToday(){return new Date().toISOString().split("T")[0]}
function xpForLevel(l){return l*120}
function earnedBadges(s){const t=s.completedAdventures.length;const c=new Set(s.completedAdventures.map(a=>a.category));return BADGES.filter(b=>{if(b.req==="streak3")return s.bestStreak>=3;if(b.req==="streak7")return s.bestStreak>=7;if(b.req==="streak14")return s.bestStreak>=14;if(b.req==="allcat")return c.size>=6;if(b.req==="location")return(s.locationAdventureCount||0)>=5;return t>=b.req})}
function timeAgo(ts){if(!ts)return"";const now=Date.now();const t=ts.toDate?ts.toDate().getTime():typeof ts==="number"?ts:Date.now();const d=Math.floor((now-t)/1000);if(d<60)return"Åimdi";if(d<3600)return Math.floor(d/60)+" dk Ã¶nce";if(d<86400)return Math.floor(d/3600)+" saat Ã¶nce";return Math.floor(d/86400)+" gÃ¼n Ã¶nce"}
async function fetchNearbyPlaces(lat,lon){const r=2000;const q=`[out:json][timeout:10];(node["tourism"~"museum|artwork|viewpoint|attraction"](around:${r},${lat},${lon});node["historic"](around:${r},${lat},${lon});node["amenity"~"cafe|restaurant|library|marketplace"](around:${r},${lat},${lon});node["leisure"~"park|garden"](around:${r},${lat},${lon});node["shop"~"books|antiques|bakery"](around:${r},${lat},${lon});way["leisure"="park"](around:${r},${lat},${lon}););out body 40;`;try{const res=await fetch("https://overpass-api.de/api/interpreter",{method:"POST",body:"data="+encodeURIComponent(q)});const data=await res.json();return data.elements.filter(e=>e.tags&&(e.tags.name||e.tags["name:tr"])).map(e=>({name:e.tags["name:tr"]||e.tags.name,type:e.tags.tourism||e.tags.historic||e.tags.amenity||e.tags.leisure||e.tags.shop||"place",lat:e.lat||e.center?.lat,lon:e.lon||e.center?.lon})).slice(0,30)}catch{return[]}}
function generatePlaceAdventure(place,interests){const t={museum:[{title:`ğŸ“ ${place.name} KeÅŸfi`,description:`${place.name} mÃ¼zesini ziyaret et.`,tips:"GiriÅŸ saatlerini kontrol et!",category:"explore",xp:45}],cafe:[{title:`ğŸ“ ${place.name}'de Mola`,description:`${place.name}'e git, denemediÄŸin bir iÃ§ecek sipariÅŸ et.`,tips:"En ilginÃ§ ÅŸeyi seÃ§!",category:"food",xp:30}],restaurant:[{title:`ğŸ“ ${place.name} Lezzeti`,description:`${place.name}'e git, en popÃ¼ler yemeÄŸi dene.`,tips:"Garsonun tavsiyesini sor!",category:"food",xp:40}],park:[{title:`ğŸ“ ${place.name} YÃ¼rÃ¼yÃ¼ÅŸÃ¼`,description:`${place.name}'de 20 dk yÃ¼rÃ¼.`,tips:"KuÅŸ seslerini dinle.",category:"fitness",xp:35}],place:[{title:`ğŸ“ ${place.name} Ziyareti`,description:`${place.name}'e git, 10 dk keÅŸfet.`,tips:"Detaylarda gÃ¼zellik var.",category:"explore",xp:35}]};const tp=t[place.type]||t.place;const f=tp.filter(x=>interests.includes(x.category));const p=f.length>0?f:tp;return{...p[Math.floor(Math.random()*p.length)],isLocation:true,placeName:place.name}}
const ADVENTURES={explore:[{title:"KayÄ±p Sokak",description:"HiÃ§ gitmediÄŸin bir sokaÄŸa sap.",tips:"Maps'i kapat!",xp:30,env:"outdoor"},{title:"Manzara AvcÄ±sÄ±",description:"En yÃ¼ksek noktayÄ± bul ve fotoÄŸrafla.",tips:"Teras veya tepe dene.",xp:40,env:"outdoor"},{title:"Zaman Yolcusu",description:"Semtindeki en eski binayÄ± bul.",tips:"KapÄ± Ã¼stÃ¼ tarihlere bak!",xp:35,env:"outdoor"},{title:"Gizli GeÃ§it",description:"Fark etmediÄŸin bir ara sokak bul.",tips:"Ana caddelerin arkasÄ±.",xp:35,env:"outdoor"},{title:"Renk AvÄ±",description:"Bir rengi 7 farklÄ± tonda fotoÄŸrafla.",tips:"GÃ¶kyÃ¼zÃ¼ saymaz!",xp:30,env:"outdoor"},{title:"KapÄ± Koleksiyoncusu",description:"En gÃ¼zel 5 kapÄ±yÄ± fotoÄŸrafla.",tips:"Eski mahalleler!",xp:30,env:"outdoor"},{title:"Harita Ã‡izici",description:"15 dk rastgele yÃ¼rÃ¼, rotayÄ± hafÄ±zadan Ã§iz.",tips:"DÃ¶nÃ¼m noktalarÄ±nÄ± hatÄ±rla.",xp:40,env:"outdoor"},{title:"Gece KaÅŸifi",description:"GÃ¼ndÃ¼z gittiÄŸin yeri gece ziyaret et.",tips:"GÃ¼venli bÃ¶lgede kal.",xp:45,env:"outdoor"},{title:"Ã‡eÅŸme AvcÄ±sÄ±",description:"BÃ¶lgendeki Ã§eÅŸmeleri bul. En az 3.",tips:"Cami avlularÄ± iyi baÅŸlangÄ±Ã§.",xp:35,env:"outdoor"},{title:"Pencere KaÅŸifi",description:"Evin her penceresinden fotoÄŸraf Ã§ek.",tips:"FarklÄ± saatlerde farklÄ± Ä±ÅŸÄ±k.",xp:25,env:"home"},{title:"Google Earth Gezgini",description:"Rastgele bir yere tÄ±kla ve 10 dk keÅŸfet.",tips:"Street View ile yÃ¼rÃ¼.",xp:25,env:"home"}],social:[{title:"GÃ¼lÃ¼mseme Zinciri",description:"5 yabancÄ±ya gÃ¼lÃ¼mse.",tips:"DoÄŸal gÃ¶z temasÄ±.",xp:30,env:"outdoor"},{title:"Eski Dost",description:"6 aydÄ±r konuÅŸmadÄ±ÄŸÄ±n birine yaz.",tips:"NasÄ±lsÄ±n? yeterli.",xp:35,env:"home"},{title:"KomÅŸu TanÄ±ÅŸmasÄ±",description:"HiÃ§ konuÅŸmadÄ±ÄŸÄ±n komÅŸuyla sohbet.",tips:"Hava durumu iyi baÅŸlangÄ±Ã§!",xp:40,env:"outdoor"},{title:"TeÅŸekkÃ¼r Turu",description:"3 kiÅŸiye minnettarlÄ±ÄŸÄ±nÄ± sÃ¶yle.",tips:"Spesifik ol.",xp:35,env:"home"},{title:"Yeni Ä°sim",description:"TanÄ±madÄ±ÄŸÄ±n birinin adÄ±nÄ± Ã¶ÄŸren.",tips:"Adla hitap et.",xp:30,env:"place"},{title:"Hikaye Dinleyici",description:"YaÅŸlÄ± birine genÃ§lik hikayesi sor.",tips:"SÃ¶zÃ¼nÃ¼ kesme.",xp:40,env:"any"},{title:"Ä°ltifat Maratonu",description:"5 kiÅŸiye samimi iltifat et.",tips:"KalÄ±p cÃ¼mle kullanma.",xp:30,env:"outdoor"},{title:"Aile GÃ¼nÃ¼",description:"Aileden biriyle aktivite yap.",tips:"Telefonlar kenarda.",xp:40,env:"home"},{title:"Rastgele YardÄ±m",description:"Birine kÃ¼Ã§Ã¼k yardÄ±m et.",tips:"FÄ±rsatlar her yerde.",xp:35,env:"outdoor"},{title:"Sesli Mesaj SÃ¼rprizi",description:"3 kiÅŸiye sesli mesaj gÃ¶nder.",tips:"GÃ¼lÃ¼mserken kaydet.",xp:30,env:"home"}],creative:[{title:"60 Saniye Sanat",description:"Ã–nÃ¼ndekini 60 saniyede Ã§iz.",tips:"Telefon uygulamasÄ± da olur!",xp:30,env:"home"},{title:"Hikaye AvcÄ±sÄ±",description:"3 nesneden 5 cÃ¼mlelik hikaye yaz.",tips:"AlakasÄ±z nesneler = eÄŸlence.",xp:35,env:"home"},{title:"Ses KolajÄ±",description:"5 farklÄ± sesi kaydet.",tips:"10 sn yeterli.",xp:35,env:"outdoor"},{title:"GÃ¶lge SanatÃ§Ä±sÄ±",description:"3 ilginÃ§ gÃ¶lge fotoÄŸrafla.",tips:"Ã–ÄŸle saati en dramatik.",xp:30,env:"outdoor"},{title:"Haiku YazarÄ±",description:"3 haiku yaz (5-7-5 hece).",tips:"AnÄ± yakala.",xp:35,env:"home"},{title:"MÃ¼zik Dedektifi",description:"DuyduÄŸun ÅŸarkÄ±yÄ± Shazam'la.",tips:"Yeni mÃ¼zik en gÃ¼zel keÅŸif.",xp:30,env:"place"},{title:"FotoÄŸraf Hikayesi",description:"5 fotoÄŸrafla hikaye anlat.",tips:"SÄ±ra ÅŸart deÄŸil.",xp:40,env:"outdoor"},{title:"Sol El Denemesi",description:"DiÄŸer elinle Ã§iz veya yaz.",tips:"GÃ¼l ve devam et!",xp:35,env:"home"},{title:"DoÄŸa KolajÄ±",description:"Yaprak, taÅŸla kompozisyon oluÅŸtur.",tips:"Simetri gÃ¼zel sonuÃ§ verir.",xp:40,env:"outdoor"},{title:"Spotify MacerasÄ±",description:"KeÅŸfet'te 3 ÅŸarkÄ± dinle.",tips:"FarklÄ± tÃ¼rler dene!",xp:25,env:"home"}],mindful:[{title:"5 Duyu Meditasyonu",description:"5 gÃ¶r, 4 dokun, 3 duy, 2 kokla, 1 tat.",tips:"3 derin nefes al.",xp:30,env:"any"},{title:"Dijital Detox",description:"1 saat telefonu uÃ§ak moduna al.",tips:"BaÅŸka odaya bÄ±rak.",xp:40,env:"home"},{title:"ÅÃ¼kran Mektubu",description:"Minnettar olduÄŸun birine yaz.",tips:"El yazÄ±sÄ± daha anlamlÄ±.",xp:35,env:"home"},{title:"Bulut Seyri",description:"15 dk gÃ¶kyÃ¼zÃ¼ne bak.",tips:"Ã‡imenlere uzan.",xp:30,env:"outdoor"},{title:"Sessiz YÃ¼rÃ¼yÃ¼ÅŸ",description:"20 dk mÃ¼ziksiz yÃ¼rÃ¼.",tips:"YÃ¼rÃ¼yÃ¼ÅŸ meditasyonu.",xp:35,env:"outdoor"},{title:"Nefes SayacÄ±",description:"5 dk nefes say.",tips:"Kayarsa geri dÃ¶n.",xp:30,env:"home"},{title:"GÃ¼nlÃ¼k Tek Sayfa",description:"BugÃ¼nÃ¼ tek sayfaya yaz.",tips:"DÃ¼rÃ¼st yaz.",xp:35,env:"home"},{title:"YavaÅŸ Yemek",description:"Bir Ã¶ÄŸÃ¼nÃ¼ 30 dk'da ye.",tips:"Telefon ve TV kapalÄ±.",xp:40,env:"home"},{title:"GÃ¼n BatÄ±mÄ±",description:"GÃ¼n batÄ±mÄ±nÄ± izle.",tips:"YÃ¼ksek yer + Ã§ay.",xp:35,env:"outdoor"},{title:"VÃ¼cut TaramasÄ±",description:"10 dk vÃ¼cudunu tara.",tips:"YouTube'da body scan ara.",xp:30,env:"home"}],food:[{title:"Bilinmeyen Lezzet",description:"HiÃ§ denemediÄŸin bir Ã¼rÃ¼n al.",tips:"Egzotik meyveler!",xp:30,env:"outdoor"},{title:"AÅŸÃ§Ä± Modu",description:"BuzdolabÄ±ndakilerle tarifsiz yemek yap.",tips:"Baharat Ã§ekmecen dostun.",xp:40,env:"home"},{title:"Kahve RitÃ¼eli",description:"Kahveni Ã¶zenle hazÄ±rla.",tips:"TÃ¼rk kahvesi veya french press.",xp:30,env:"home"},{title:"Sokak Lezzeti",description:"Sokak satÄ±cÄ±sÄ±ndan bir ÅŸey al.",tips:"Atmosferi hisset.",xp:30,env:"outdoor"},{title:"DÃ¼nya MutfaÄŸÄ±",description:"FarklÄ± Ã¼lke mutfaÄŸÄ± dene.",tips:"Hint, Tayland, Kore!",xp:40,env:"place"},{title:"Ã‡ocukluk Lezzeti",description:"Ã‡ocukken sevdiÄŸin yemeÄŸi yap.",tips:"Tarifi sor ailene.",xp:35,env:"home"},{title:"SÄ±fÄ±r AtÄ±k",description:"Bitecek malzemelerle yemek yap.",tips:"Ã‡orba ve omlet kurtarÄ±r.",xp:35,env:"home"},{title:"TatlÄ± Deney",description:"Basit bir tatlÄ± dene.",tips:"Mug cake 5 dk!",xp:35,env:"home"},{title:"Baharat MacerasÄ±",description:"KullanmadÄ±ÄŸÄ±n baharatla yemek yap.",tips:"ZerdeÃ§al, kimyon, kekik.",xp:30,env:"home"},{title:"Ã‡ay Degustasyonu",description:"3 farklÄ± Ã§ayÄ± dene.",tips:"KÃ¼Ã§Ã¼k fincanlar kullan.",xp:25,env:"home"}],fitness:[{title:"1000 AdÄ±m Ekstra",description:"1000 adÄ±m fazla yÃ¼rÃ¼.",tips:"Ã–ÄŸle molasÄ±nda 15 dk.",xp:30,env:"outdoor"},{title:"Park JimnastiÄŸi",description:"10 ÅŸÄ±nav, 20 squat, 30sn plank.",tips:"Bank kullan.",xp:40,env:"outdoor"},{title:"Esneme SeansÄ±",description:"15 dk tÃ¼m vÃ¼cudu esnet.",tips:"YouTube'da stretch ara.",xp:30,env:"home"},{title:"Dans Partisi",description:"3 ÅŸarkÄ± aÃ§, dans et!",tips:"Perdeleri kapat!",xp:35,env:"home"},{title:"Merdiven TÄ±rmanÄ±cÄ±",description:"En az 10 kat merdiven Ã§Ä±k.",tips:"AdÄ±m sayar kullan.",xp:40,env:"outdoor"},{title:"7 Dakika Egzersiz",description:"7 dk HIIT yap.",tips:"Sadece 7 dk ama etkili!",xp:35,env:"home"},{title:"YÃ¼rÃ¼yÃ¼ÅŸ BuluÅŸmasÄ±",description:"ArkadaÅŸÄ±nÄ± yÃ¼rÃ¼yÃ¼ÅŸe Ã§aÄŸÄ±r.",tips:"30 dk yeterli.",xp:35,env:"outdoor"},{title:"Sabah Rutini",description:"YarÄ±n sabah 5 dk egzersiz.",tips:"10 squat, 10 jumping jack.",xp:40,env:"home"},{title:"Denge UstasÄ±",description:"Tek ayakta 30sn dur.",tips:"Bir noktaya odaklan.",xp:30,env:"home"},{title:"Ev Turu KoÅŸusu",description:"5 dk evde dur durma.",tips:"Hafif adÄ±mlarla!",xp:30,env:"home"}]};
function getRandomAdventure(interests,difficulty,completedTitles,nearbyPlaces,useLocation,env){if(useLocation&&nearbyPlaces&&nearbyPlaces.length>0&&(!env||env==="place"||env==="any")&&Math.random()<0.45){const up=nearbyPlaces.filter(p=>!completedTitles.some(t=>t.includes(p.name)));const pp=up.length>0?up:nearbyPlaces;const place=pp[Math.floor(Math.random()*pp.length)];const adv=generatePlaceAdventure(place,interests);if(difficulty==="medium")adv.xp=Math.round(adv.xp*1.5);if(difficulty==="hard")adv.xp=adv.xp*2;return adv}let pool=[];interests.forEach(cat=>{(ADVENTURES[cat]||[]).forEach(a=>{if(!completedTitles.includes(a.title)){if(!env||env==="any"||a.env===env||a.env==="any")pool.push({...a,category:cat})}})});if(pool.length===0)interests.forEach(cat=>{(ADVENTURES[cat]||[]).forEach(a=>{if(!env||env==="any"||a.env===env||a.env==="any")pool.push({...a,category:cat})})});if(pool.length===0)interests.forEach(cat=>{(ADVENTURES[cat]||[]).forEach(a=>{pool.push({...a,category:cat})})});const adv=pool[Math.floor(Math.random()*pool.length)];if(difficulty==="medium")adv.xp=Math.round(adv.xp*1.5);if(difficulty==="hard")adv.xp=adv.xp*2;return adv}
function PhotoLightbox({src,onClose}){if(!src)return null;return(<div onClick={onClose} style={{position:"fixed",inset:0,zIndex:9999,background:"rgba(0,0,0,0.92)",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",cursor:"zoom-out"}}><img src={src} style={{maxWidth:"100%",maxHeight:"90vh",borderRadius:"12px",objectFit:"contain"}}/><button onClick={onClose} style={{position:"absolute",top:"16px",right:"16px",width:"40px",height:"40px",borderRadius:"50%",border:"none",background:"rgba(255,255,255,0.15)",color:"#fff",fontSize:"22px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>Ã—</button></div>)}
function AnimatedBg(){return(<div style={{position:"fixed",inset:0,zIndex:0,overflow:"hidden",background:"linear-gradient(135deg,#0F0A1A 0%,#1A1035 40%,#0D1926 100%)"}}>{[...Array(6)].map((_,i)=>(<div key={i} style={{position:"absolute",borderRadius:"50%",filter:"blur(80px)",opacity:0.12,animation:`floatBlob ${14+i*3}s ease-in-out infinite alternate`,background:["#FF6B35","#A855F7","#4ECDC4","#F59E0B","#06B6D4","#EF4444"][i],width:`${200+i*80}px`,height:`${200+i*80}px`,left:`${10+i*15}%`,top:`${10+((i*37)%70)}%`}}/>))}<style>{`@keyframes floatBlob{0%{transform:translate(0,0) scale(1)}100%{transform:translate(30px,-40px) scale(1.2)}}`}</style></div>)}
function Glass({children,style,onClick}){return(<div onClick={onClick} style={{background:"rgba(255,255,255,0.04)",backdropFilter:"blur(20px)",WebkitBackdropFilter:"blur(20px)",border:"1px solid rgba(255,255,255,0.08)",borderRadius:"20px",...style}}>{children}</div>)}
function AuthScreen({onAuth}){const[mode,setMode]=useState("login");const[email,setEmail]=useState("");const[pass,setPass]=useState("");const[error,setError]=useState("");const[loading,setLoading]=useState(false);const handleEmail=async()=>{setError("");setLoading(true);if(mode==="login"){const r=await loginWithEmail(email,pass);if(r.error)setError(r.error);else onAuth(r.uid)}else{const r=await registerWithEmail(email,pass);if(r.error)setError(r.error);else onAuth(r.uid)}setLoading(false)};const handleGoogle=async()=>{setError("");setLoading(true);const r=await loginWithGoogle();if(r.error)setError(r.error);else onAuth(r.uid,r.displayName);setLoading(false)};return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",zIndex:1}}><Glass style={{maxWidth:"420px",width:"100%",padding:"40px 32px",textAlign:"center"}}><div style={{fontSize:"56px",marginBottom:"12px"}}>ğŸŒ</div><h1 style={{fontFamily:"'Playfair Display',Georgia,serif",fontSize:"32px",fontWeight:700,color:"#fff",marginBottom:"6px"}}>Wanderly</h1><p style={{color:"rgba(255,255,255,0.45)",fontSize:"14px",marginBottom:"28px"}}>Her gÃ¼n yeni bir macera</p><button onClick={handleGoogle} disabled={loading} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.06)",color:"#fff",fontSize:"15px",fontWeight:600,cursor:"pointer",marginBottom:"16px",display:"flex",alignItems:"center",justifyContent:"center",gap:"10px"}}><span style={{fontSize:"20px"}}>ğŸ”µ</span>Google ile {mode==="login"?"GiriÅŸ Yap":"KayÄ±t Ol"}</button><div style={{display:"flex",alignItems:"center",gap:"12px",marginBottom:"16px"}}><div style={{flex:1,height:"1px",background:"rgba(255,255,255,0.1)"}}/><span style={{color:"rgba(255,255,255,0.3)",fontSize:"12px"}}>veya</span><div style={{flex:1,height:"1px",background:"rgba(255,255,255,0.1)"}}/></div><input type="email" placeholder="Email" value={email} onChange={e=>setEmail(e.target.value)} style={{width:"100%",padding:"13px 16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"14px",outline:"none",marginBottom:"10px",boxSizing:"border-box"}}/><input type="password" placeholder="Åifre (min 6 karakter)" value={pass} onChange={e=>setPass(e.target.value)} onKeyDown={e=>e.key==="Enter"&&handleEmail()} style={{width:"100%",padding:"13px 16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"14px",outline:"none",marginBottom:"14px",boxSizing:"border-box"}}/>{error&&<div style={{color:"#EF4444",fontSize:"13px",marginBottom:"12px",background:"rgba(239,68,68,0.1)",padding:"10px",borderRadius:"10px"}}>{error}</div>}<button onClick={handleEmail} disabled={loading||!email||!pass} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:(email&&pass)?"linear-gradient(135deg,#FF6B35,#A855F7)":"rgba(255,255,255,0.08)",color:"#fff",fontSize:"15px",fontWeight:600,cursor:(email&&pass)?"pointer":"default",opacity:(email&&pass)?1:0.4,marginBottom:"16px"}}>{loading?"â³":mode==="login"?"GiriÅŸ Yap":"KayÄ±t Ol"}</button><p style={{color:"rgba(255,255,255,0.4)",fontSize:"13px"}}>{mode==="login"?"HesabÄ±n yok mu? ":"Zaten hesabÄ±n var mÄ±? "}<span onClick={()=>{setMode(mode==="login"?"register":"login");setError("")}} style={{color:"#A855F7",cursor:"pointer",fontWeight:600}}>{mode==="login"?"KayÄ±t Ol":"GiriÅŸ Yap"}</span></p></Glass></div>)}
function ProfileSetup({uid,initialName,onComplete}){const[username,setUsername]=useState("");const[displayName,setDisplayName]=useState(initialName||"");const[avatar,setAvatar]=useState(null);const[checking,setChecking]=useState(false);const[available,setAvailable]=useState(null);const[error,setError]=useState("");const[loading,setLoading]=useState(false);const checkName=async(name)=>{if(name.length<3){setAvailable(null);return}setChecking(true);const ok=await checkUsernameAvailable(name);setAvailable(ok);setChecking(false)};const handleAvatarUpload=(e)=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>{const img=new Image();img.onload=()=>{const c=document.createElement("canvas");c.width=150;c.height=150;const ctx=c.getContext("2d");const s=Math.min(img.width,img.height);const sx=(img.width-s)/2;const sy=(img.height-s)/2;ctx.drawImage(img,sx,sy,s,s,0,0,150,150);setAvatar(c.toDataURL("image/jpeg",0.7))};img.src=ev.target.result};r.readAsDataURL(f)}};const handleSubmit=async()=>{if(!username||username.length<3)return setError("KullanÄ±cÄ± adÄ± en az 3 karakter.");if(!available)return setError("Bu kullanÄ±cÄ± adÄ± alÄ±nmÄ±ÅŸ.");if(!displayName.trim())return setError("GÃ¶rÃ¼nen isim gerekli.");setLoading(true);const res=await createUserProfile(uid,{username:username.trim(),displayName:displayName.trim(),avatar});if(res.error)setError(res.error);else onComplete({username:username.trim(),displayName:displayName.trim(),avatar});setLoading(false)};return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",zIndex:1}}><Glass style={{maxWidth:"420px",width:"100%",padding:"36px 28px",textAlign:"center"}}><h2 style={{color:"#fff",fontSize:"22px",fontWeight:700,marginBottom:"6px"}}>Profilini OluÅŸtur</h2><p style={{color:"rgba(255,255,255,0.4)",fontSize:"13px",marginBottom:"24px"}}>Toplulukta nasÄ±l gÃ¶rÃ¼nmek istersin?</p><div style={{marginBottom:"20px"}}><label style={{cursor:"pointer"}}><div style={{width:"80px",height:"80px",borderRadius:"50%",background:avatar?"none":"linear-gradient(135deg,#FF6B35,#A855F7)",margin:"0 auto 8px",display:"flex",alignItems:"center",justifyContent:"center",overflow:"hidden",border:"3px solid rgba(255,255,255,0.15)"}}>{avatar?<img src={avatar} style={{width:"100%",height:"100%",objectFit:"cover"}}/>:<span style={{color:"#fff",fontSize:"28px"}}>ğŸ“·</span>}</div><input type="file" accept="image/*" style={{display:"none"}} onChange={handleAvatarUpload}/></label><div style={{color:"rgba(255,255,255,0.35)",fontSize:"11px"}}>Profil fotoÄŸrafÄ± ekle</div></div><div style={{position:"relative",marginBottom:"14px"}}><input type="text" placeholder="KullanÄ±cÄ± adÄ± (Ã¶rn: kasifattt)" value={username} onChange={e=>{const v=e.target.value.toLowerCase().replace(/[^a-z0-9_]/g,"");setUsername(v);setError("");checkName(v)}} style={{width:"100%",padding:"13px 40px 13px 16px",borderRadius:"12px",border:`1px solid ${available===true?"rgba(16,185,129,0.4)":available===false?"rgba(239,68,68,0.4)":"rgba(255,255,255,0.1)"}`,background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"14px",outline:"none",boxSizing:"border-box"}}/>{username.length>=3&&!checking&&<div style={{position:"absolute",right:"14px",top:"50%",transform:"translateY(-50%)",fontSize:"16px"}}>{available?"âœ…":"âŒ"}</div>}{checking&&<div style={{position:"absolute",right:"14px",top:"50%",transform:"translateY(-50%)",fontSize:"14px",color:"rgba(255,255,255,0.3)"}}>...</div>}</div><input type="text" placeholder="GÃ¶rÃ¼nen isim (Ã¶rn: Batuhan)" value={displayName} onChange={e=>setDisplayName(e.target.value)} style={{width:"100%",padding:"13px 16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"14px",outline:"none",marginBottom:"14px",boxSizing:"border-box"}}/>{error&&<div style={{color:"#EF4444",fontSize:"13px",marginBottom:"12px",background:"rgba(239,68,68,0.1)",padding:"10px",borderRadius:"10px"}}>{error}</div>}<button onClick={handleSubmit} disabled={loading||!username||!displayName.trim()} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:(username&&displayName.trim())?"linear-gradient(135deg,#FF6B35,#A855F7)":"rgba(255,255,255,0.08)",color:"#fff",fontSize:"15px",fontWeight:600,opacity:(username&&displayName.trim())?1:0.4}}>{loading?"â³ OluÅŸturuluyor...":"Profili OluÅŸtur âœ¨"}</button></Glass></div>)}
function Onboarding({onComplete}){const[step,setStep]=useState(0);const[interests,setInterests]=useState([]);const[difficulty,setDifficulty]=useState("easy");const[locationEnabled,setLocationEnabled]=useState(false);const[city,setCity]=useState(null);const[lat,setLat]=useState(null);const[lon,setLon]=useState(null);const[nearbyPlaces,setNearbyPlaces]=useState([]);const[locLoading,setLocLoading]=useState(false);const toggleInterest=(id)=>setInterests(p=>p.includes(id)?p.filter(x=>x!==id):[...p,id]);const requestLocation=()=>{setLocLoading(true);if(navigator.geolocation){navigator.geolocation.getCurrentPosition(async(pos)=>{const lt=pos.coords.latitude,ln=pos.coords.longitude;setLat(lt);setLon(ln);try{const res=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lt}&lon=${ln}&format=json&accept-language=tr`);const data=await res.json();setCity(data.address?.city||data.address?.town||data.address?.province||"Konum alÄ±ndÄ±")}catch{setCity("Konum alÄ±ndÄ±")}const places=await fetchNearbyPlaces(lt,ln);setNearbyPlaces(places);setLocationEnabled(true);setLocLoading(false)},()=>setLocLoading(false))}else setLocLoading(false)};return(<div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",padding:"20px",position:"relative",zIndex:1}}><Glass style={{maxWidth:"480px",width:"100%",padding:"40px 32px",textAlign:"center"}}>{step===0&&(<div style={{animation:"fadeUp 0.5s ease"}}><div style={{fontSize:"48px",marginBottom:"12px"}}>ğŸ¯</div><h2 style={{color:"#fff",fontSize:"22px",fontWeight:600,marginBottom:"8px"}}>Nelerden hoÅŸlanÄ±rsÄ±n?</h2><p style={{color:"rgba(255,255,255,0.45)",fontSize:"14px",marginBottom:"24px"}}>En az 2 kategori seÃ§</p><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px",marginBottom:"24px"}}>{CATEGORIES.map(cat=>{const sel=interests.includes(cat.id);return(<div key={cat.id} onClick={()=>toggleInterest(cat.id)} style={{padding:"16px 12px",borderRadius:"14px",border:`2px solid ${sel?cat.color:"rgba(255,255,255,0.08)"}`,background:sel?`${cat.color}18`:"rgba(255,255,255,0.02)",cursor:"pointer"}}><div style={{fontSize:"28px",marginBottom:"6px"}}>{cat.emoji}</div><div style={{color:sel?cat.color:"rgba(255,255,255,0.6)",fontSize:"13px",fontWeight:600}}>{cat.label}</div></div>)})}</div><button disabled={interests.length<2} onClick={()=>setStep(1)} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:interests.length>=2?"linear-gradient(135deg,#FF6B35,#A855F7)":"rgba(255,255,255,0.08)",color:"#fff",fontSize:"16px",fontWeight:600,opacity:interests.length>=2?1:0.4}}>Devam â†’</button></div>)}{step===1&&(<div style={{animation:"fadeUp 0.5s ease"}}><h2 style={{color:"#fff",fontSize:"22px",fontWeight:600,marginBottom:"16px"}}>Zorluk seviyeni seÃ§</h2><div style={{display:"flex",flexDirection:"column",gap:"10px",marginBottom:"24px"}}>{DIFFICULTY_LEVELS.map(d=>{const sel=difficulty===d.id;return(<div key={d.id} onClick={()=>setDifficulty(d.id)} style={{padding:"16px 20px",borderRadius:"14px",border:`2px solid ${sel?"#FF6B35":"rgba(255,255,255,0.08)"}`,background:sel?"rgba(255,107,53,0.1)":"rgba(255,255,255,0.02)",cursor:"pointer",display:"flex",alignItems:"center",gap:"14px"}}><span style={{fontSize:"28px"}}>{d.emoji}</span><div style={{textAlign:"left"}}><div style={{color:sel?"#FF6B35":"#fff",fontWeight:600}}>{d.label}</div><div style={{color:"rgba(255,255,255,0.4)",fontSize:"12px"}}>{d.desc}</div></div></div>)})}</div><button onClick={()=>setStep(2)} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:"linear-gradient(135deg,#FF6B35,#A855F7)",color:"#fff",fontSize:"16px",fontWeight:600,cursor:"pointer"}}>Devam â†’</button></div>)}{step===2&&(<div style={{animation:"fadeUp 0.5s ease"}}><div style={{fontSize:"48px",marginBottom:"16px"}}>ğŸ“</div><h2 style={{color:"#fff",fontSize:"22px",fontWeight:600,marginBottom:"8px"}}>Konum bazlÄ± maceralar</h2><p style={{color:"rgba(255,255,255,0.45)",fontSize:"14px",marginBottom:"24px"}}>Konumunu paylaÅŸÄ±rsan gerÃ§ek mekanlarÄ± keÅŸfedersin!</p>{locationEnabled?(<div style={{background:"rgba(16,185,129,0.1)",border:"1px solid rgba(16,185,129,0.3)",borderRadius:"14px",padding:"16px",marginBottom:"20px"}}><div style={{color:"#10B981",fontSize:"14px",fontWeight:600}}>âœ“ Konum alÄ±ndÄ±!</div>{city&&<div style={{color:"rgba(255,255,255,0.5)",fontSize:"13px",marginTop:"4px"}}>ğŸ“ {city}</div>}{nearbyPlaces.length>0&&<div style={{color:"rgba(255,255,255,0.4)",fontSize:"12px",marginTop:"6px"}}>ğŸ›ï¸ {nearbyPlaces.length} mekan bulundu</div>}</div>):(<button onClick={requestLocation} disabled={locLoading} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"2px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"15px",fontWeight:600,cursor:"pointer",marginBottom:"12px"}}>{locLoading?"ğŸ“¡ AranÄ±yor...":"ğŸ“ Konumumu PaylaÅŸ"}</button>)}<button onClick={()=>onComplete({interests,difficulty,locationEnabled,city,lat,lon,nearbyPlaces})} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:"linear-gradient(135deg,#FF6B35,#A855F7)",color:"#fff",fontSize:"16px",fontWeight:600,cursor:"pointer",marginTop:"8px"}}>{locationEnabled?"Maceraya BaÅŸla ğŸš€":"Konumsuz Devam Et â†’"}</button></div>)}</Glass><style>{`@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}`}</style></div>)}
function AdventureCard({adventure,onComplete,onSkip,skipsLeft}){const[note,setNote]=useState("");const[completing,setCompleting]=useState(false);const[photo,setPhoto]=useState(null);const cat=CATEGORIES.find(c=>c.id===adventure.category)||CATEGORIES[0];return(<Glass style={{padding:"0",overflow:"hidden",animation:"fadeUp 0.6s ease",maxWidth:"480px",width:"100%"}}><div style={{background:`linear-gradient(135deg,${cat.color}30,${cat.color}08)`,padding:"28px 24px 20px",borderBottom:"1px solid rgba(255,255,255,0.06)"}}><div style={{display:"flex",alignItems:"center",gap:"10px",marginBottom:"16px",flexWrap:"wrap"}}><span style={{background:`${cat.color}25`,padding:"6px 14px",borderRadius:"20px",fontSize:"13px",color:cat.color,fontWeight:600}}>{cat.emoji} {cat.label}</span>{adventure.isLocation&&<span style={{background:"rgba(16,185,129,0.15)",padding:"6px 12px",borderRadius:"20px",fontSize:"12px",color:"#10B981",fontWeight:600}}>ğŸ“ YakÄ±nÄ±nda</span>}<span style={{color:"rgba(255,255,255,0.35)",fontSize:"13px"}}>+{adventure.xp} XP</span></div><h2 style={{color:"#fff",fontSize:"22px",fontWeight:700,lineHeight:1.35,marginBottom:"10px",fontFamily:"'Playfair Display',Georgia,serif"}}>{adventure.title}</h2><p style={{color:"rgba(255,255,255,0.55)",fontSize:"15px",lineHeight:1.65}}>{adventure.description}</p></div>{adventure.tips&&(<div style={{padding:"16px 24px",borderBottom:"1px solid rgba(255,255,255,0.06)"}}><div style={{color:"rgba(255,255,255,0.35)",fontSize:"11px",fontWeight:700,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"8px"}}>ğŸ’¡ Ä°pucu</div><p style={{color:"rgba(255,255,255,0.5)",fontSize:"13px",lineHeight:1.6}}>{adventure.tips}</p></div>)}<div style={{padding:"20px 24px 24px"}}>{!completing?(<><button onClick={()=>setCompleting(true)} style={{width:"100%",padding:"15px",borderRadius:"14px",border:"none",background:`linear-gradient(135deg,${cat.color},${cat.color}CC)`,color:"#fff",fontSize:"16px",fontWeight:700,cursor:"pointer"}}>âœ“ TamamladÄ±m!</button>{skipsLeft>0?(<button onClick={onSkip} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"transparent",color:"rgba(255,255,255,0.4)",fontSize:"13px",fontWeight:500,cursor:"pointer",marginTop:"8px"}}>ğŸ”„ BaÅŸka macera ({skipsLeft} hak)</button>):(<div style={{textAlign:"center",color:"rgba(255,255,255,0.2)",fontSize:"12px",marginTop:"10px"}}>BugÃ¼nkÃ¼ deÄŸiÅŸtirme hakkÄ±n bitti</div>)}</>):(<div style={{animation:"fadeUp 0.3s ease"}}><textarea placeholder="NasÄ±l geÃ§ti? (opsiyonel)" value={note} onChange={e=>setNote(e.target.value)} rows={3} style={{width:"100%",padding:"12px 16px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"14px",resize:"none",outline:"none",marginBottom:"12px",boxSizing:"border-box"}}/>{photo?(<div style={{position:"relative",marginBottom:"12px"}}><img src={photo} style={{width:"100%",borderRadius:"12px",maxHeight:"200px",objectFit:"cover"}}/><button onClick={()=>setPhoto(null)} style={{position:"absolute",top:"8px",right:"8px",width:"28px",height:"28px",borderRadius:"50%",border:"none",background:"rgba(0,0,0,0.6)",color:"#fff",fontSize:"16px",cursor:"pointer",display:"flex",alignItems:"center",justifyContent:"center"}}>Ã—</button></div>):(<label style={{display:"flex",alignItems:"center",justifyContent:"center",gap:"8px",width:"100%",padding:"12px",borderRadius:"12px",border:"1px dashed rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.02)",color:"rgba(255,255,255,0.4)",fontSize:"13px",cursor:"pointer",marginBottom:"12px"}}><span>ğŸ“· FotoÄŸraf ekle</span><input type="file" accept="image/*" style={{display:"none"}} onChange={e=>{const f=e.target.files[0];if(f){const r=new FileReader();r.onload=ev=>setPhoto(ev.target.result);r.readAsDataURL(f)}}}/></label>)}<button onClick={()=>onComplete(note,photo)} style={{width:"100%",padding:"14px",borderRadius:"14px",border:"none",background:"linear-gradient(135deg,#10B981,#059669)",color:"#fff",fontSize:"15px",fontWeight:700,cursor:"pointer"}}>ğŸ‰ Kaydet</button></div>)}</div></Glass>)}
function StatsPanel({state}){const xpN=xpForLevel(state.level);const prog=Math.min((state.xp/xpN)*100,100);const badges=earnedBadges(state);return(<Glass style={{padding:"24px",maxWidth:"480px",width:"100%",animation:"fadeUp 0.5s ease"}}><div style={{marginBottom:"20px"}}><div style={{display:"flex",justifyContent:"space-between",marginBottom:"8px"}}><span style={{color:"rgba(255,255,255,0.5)",fontSize:"12px",fontWeight:600}}>Seviye {state.level}</span><span style={{color:"rgba(255,255,255,0.35)",fontSize:"12px"}}>{state.xp}/{xpN} XP</span></div><div style={{height:"8px",borderRadius:"4px",background:"rgba(255,255,255,0.06)",overflow:"hidden"}}><div style={{height:"100%",width:`${prog}%`,borderRadius:"4px",background:"linear-gradient(90deg,#FF6B35,#A855F7)",transition:"width 0.8s ease"}}/></div></div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"12px",marginBottom:"20px"}}>{[{label:"Macera",value:state.completedAdventures.length,emoji:"ğŸ”ï¸"},{label:"Seri",value:`${state.streak} gÃ¼n`,emoji:"ğŸ”¥"},{label:"En Ä°yi",value:`${state.bestStreak} gÃ¼n`,emoji:"ğŸ’"}].map(s=>(<div key={s.label} style={{textAlign:"center",padding:"14px 8px",borderRadius:"12px",background:"rgba(255,255,255,0.03)"}}><div style={{fontSize:"22px",marginBottom:"4px"}}>{s.emoji}</div><div style={{color:"#fff",fontSize:"18px",fontWeight:700}}>{s.value}</div><div style={{color:"rgba(255,255,255,0.35)",fontSize:"11px",marginTop:"2px"}}>{s.label}</div></div>))}</div>{badges.length>0&&(<div><div style={{color:"rgba(255,255,255,0.35)",fontSize:"11px",fontWeight:700,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"10px"}}>Rozetler</div><div style={{display:"flex",gap:"8px",flexWrap:"wrap"}}>{badges.map(b=>(<span key={b.id} style={{background:"rgba(255,255,255,0.06)",padding:"6px 12px",borderRadius:"20px",fontSize:"13px",color:"rgba(255,255,255,0.7)"}}>{b.emoji} {b.name}</span>))}</div></div>)}</Glass>)}
function History({adventures,onPhotoClick}){if(!adventures.length)return(<Glass style={{padding:"40px 24px",textAlign:"center",maxWidth:"480px",width:"100%"}}><div style={{fontSize:"48px",marginBottom:"12px"}}>ğŸ“</div><p style={{color:"rgba(255,255,255,0.4)",fontSize:"14px"}}>HenÃ¼z macera tamamlamadÄ±n!</p></Glass>);return(<div style={{display:"flex",flexDirection:"column",gap:"10px",maxWidth:"480px",width:"100%"}}>{adventures.slice().reverse().map((a,i)=>{const cat=CATEGORIES.find(c=>c.id===a.category)||CATEGORIES[0];return(<Glass key={i} style={{padding:"16px 20px",display:"flex",alignItems:"center",gap:"14px",animation:`fadeUp 0.4s ease ${i*0.05}s both`}}><div style={{width:"42px",height:"42px",borderRadius:"12px",background:`${cat.color}20`,display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",flexShrink:0}}>{cat.emoji}</div><div style={{flex:1,minWidth:0}}><div style={{color:"#fff",fontSize:"14px",fontWeight:600,whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"}}>{a.isLocation&&"ğŸ“ "}{a.title}</div><div style={{color:"rgba(255,255,255,0.35)",fontSize:"12px",marginTop:"2px"}}>{a.date} â€¢ +{a.xp} XP</div></div>{a.photo?<img src={a.photo} onClick={(e)=>{e.stopPropagation();onPhotoClick&&onPhotoClick(a.photo)}} style={{width:"48px",height:"48px",borderRadius:"10px",objectFit:"cover",flexShrink:0,cursor:"zoom-in",border:"2px solid rgba(255,255,255,0.1)"}}/>:<div style={{color:"#10B981",fontSize:"18px"}}>âœ“</div>}</Glass>)})}</div>)}
function Community({state,profile,onPhotoClick}){const[firebasePosts,setFirebasePosts]=useState([]);const[loading,setLoading]=useState(true);const[activeFilter,setActiveFilter]=useState("all");const[openComments,setOpenComments]=useState(null);const[newComment,setNewComment]=useState("");const[postComments,setPostComments]=useState({});const uid=getCurrentUid();const loadPosts=async()=>{setLoading(true);const posts=await getPosts(50);setFirebasePosts(posts);setLoading(false)};useEffect(()=>{loadPosts()},[]);const loadComments=async(postId)=>{const cmts=await getComments(postId);setPostComments(prev=>({...prev,[postId]:cmts}))};const handleToggleComments=async(postId)=>{if(openComments===postId){setOpenComments(null)}else{setOpenComments(postId);await loadComments(postId)}};const handleLike=async(postId)=>{if(!uid)return;await toggleLikePost(postId,uid);const posts=await getPosts(50);setFirebasePosts(posts)};const handleComment=async(postId)=>{if(!newComment.trim()||!uid||!profile)return;await addCommentToPost(postId,{uid,username:profile.username,displayName:profile.displayName,avatar:profile.avatar,text:newComment.trim()});setNewComment("");await loadComments(postId)};const handleDeleteComment=async(postId,commentId)=>{if(window.confirm("Yorumu silmek istediÄŸine emin misin?")){await deleteComment(postId,commentId);await loadComments(postId)}};const handleDeletePost=async(postId)=>{if(window.confirm("PaylaÅŸÄ±mÄ± silmek istediÄŸine emin misin?")){await deletePost(postId);await loadPosts()}};const allPosts=firebasePosts.map(p=>({...p,isMe:p.uid===uid,time:timeAgo(p.createdAt)}));const filtered=activeFilter==="all"?allPosts:allPosts.filter(p=>p.category===activeFilter);return(<div style={{display:"flex",flexDirection:"column",gap:"12px",maxWidth:"480px",width:"100%"}}><div style={{display:"flex",gap:"6px",overflowX:"auto",paddingBottom:"4px"}}><button onClick={()=>setActiveFilter("all")} style={{padding:"6px 14px",borderRadius:"20px",border:"none",background:activeFilter==="all"?"rgba(255,255,255,0.15)":"rgba(255,255,255,0.04)",color:activeFilter==="all"?"#fff":"rgba(255,255,255,0.4)",fontSize:"12px",fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>TÃ¼mÃ¼</button>{CATEGORIES.map(cat=>(<button key={cat.id} onClick={()=>setActiveFilter(cat.id)} style={{padding:"6px 14px",borderRadius:"20px",border:"none",background:activeFilter===cat.id?`${cat.color}25`:"rgba(255,255,255,0.04)",color:activeFilter===cat.id?cat.color:"rgba(255,255,255,0.4)",fontSize:"12px",fontWeight:600,cursor:"pointer",whiteSpace:"nowrap"}}>{cat.emoji} {cat.label}</button>))}</div>{loading?(<Glass style={{padding:"40px 24px",textAlign:"center"}}><div style={{fontSize:"32px",marginBottom:"12px",animation:"pulse 1.5s infinite"}}><style>{`@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.4}}`}</style>ğŸ”„</div><p style={{color:"rgba(255,255,255,0.4)",fontSize:"14px"}}>Topluluk yÃ¼kleniyor...</p></Glass>):filtered.length===0?(<Glass style={{padding:"40px 24px",textAlign:"center"}}><div style={{fontSize:"40px",marginBottom:"12px"}}>ğŸ’¬</div><p style={{color:"rgba(255,255,255,0.4)",fontSize:"14px"}}>HenÃ¼z paylaÅŸÄ±m yok. Ä°lk maceranÄ± tamamla!</p></Glass>):filtered.map((post)=>{const cat=CATEGORIES.find(c=>c.id===post.category)||CATEGORIES[0];const liked=(post.likedBy||[]).includes(uid);const likeCount=post.likes||0;const isOpen=openComments===post.id;const cmts=postComments[post.id]||[];return(<Glass key={post.id} style={{padding:"0",overflow:"hidden",animation:"fadeUp 0.4s ease"}}><div style={{padding:"16px 20px 12px",display:"flex",alignItems:"center",gap:"12px"}}><div style={{width:"40px",height:"40px",borderRadius:"50%",overflow:"hidden",background:post.avatar?"none":"linear-gradient(135deg,#FF6B35,#A855F7)",display:"flex",alignItems:"center",justifyContent:"center",fontSize:"20px",flexShrink:0,border:"2px solid rgba(255,255,255,0.1)"}}>{post.avatar?<img src={post.avatar} style={{width:"100%",height:"100%",objectFit:"cover"}}/>:<span style={{color:"#fff",fontSize:"16px"}}>{(post.displayName||post.username||"?")[0].toUpperCase()}</span>}</div><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:"6px"}}><span style={{color:"#fff",fontSize:"14px",fontWeight:600}}>{post.displayName||post.username}</span>{post.username&&<span style={{color:"rgba(255,255,255,0.3)",fontSize:"11px"}}>@{post.username}</span>}{post.isMe&&<span style={{background:"linear-gradient(135deg,#FF6B35,#A855F7)",padding:"2px 8px",borderRadius:"10px",fontSize:"10px",color:"#fff",fontWeight:600}}>Sen</span>}</div><div style={{color:"rgba(255,255,255,0.3)",fontSize:"11px",marginTop:"2px"}}>{post.time}</div></div><div style={{display:"flex",alignItems:"center",gap:"6px"}}><span style={{background:`${cat.color}20`,padding:"4px 10px",borderRadius:"12px",fontSize:"11px",color:cat.color,fontWeight:600}}>{cat.emoji}</span>{post.isMe&&<button onClick={()=>handleDeletePost(post.id)} style={{background:"none",border:"none",color:"rgba(255,255,255,0.2)",fontSize:"16px",cursor:"pointer",padding:"4px"}}>ğŸ—‘ï¸</button>}</div></div><div style={{padding:"0 20px 8px"}}><div style={{color:"rgba(255,255,255,0.7)",fontSize:"15px",fontWeight:600}}>{post.title}</div></div><div style={{padding:"0 20px 16px"}}><p style={{color:"rgba(255,255,255,0.55)",fontSize:"14px",lineHeight:1.6,margin:0}}>{post.note}</p>{post.photo&&<img src={post.photo} onClick={(e)=>{e.stopPropagation();onPhotoClick&&onPhotoClick(post.photo)}} style={{width:"100%",borderRadius:"12px",marginTop:"12px",maxHeight:"250px",objectFit:"cover",cursor:"zoom-in"}}/>}</div><div style={{padding:"0 20px 12px",display:"flex",alignItems:"center",gap:"12px"}}><button onClick={()=>handleLike(post.id)} style={{display:"flex",alignItems:"center",gap:"6px",border:"none",cursor:"pointer",padding:"6px 12px",borderRadius:"20px",background:liked?"rgba(239,68,68,0.1)":"rgba(255,255,255,0.04)"}}><span style={{fontSize:"16px"}}>{liked?"â¤ï¸":"ğŸ¤"}</span><span style={{color:liked?"#EF4444":"rgba(255,255,255,0.4)",fontSize:"13px",fontWeight:600}}>{likeCount}</span></button><button onClick={()=>handleToggleComments(post.id)} style={{display:"flex",alignItems:"center",gap:"6px",border:"none",cursor:"pointer",padding:"6px 12px",borderRadius:"20px",background:isOpen?"rgba(59,130,246,0.1)":"rgba(255,255,255,0.04)"}}><span style={{fontSize:"16px"}}>ğŸ’¬</span><span style={{color:isOpen?"#3B82F6":"rgba(255,255,255,0.4)",fontSize:"13px",fontWeight:600}}>{cmts.length||""}</span></button></div>{isOpen&&(<div style={{borderTop:"1px solid rgba(255,255,255,0.06)",padding:"12px 20px 16px",animation:"fadeUp 0.3s ease"}}>{cmts.length>0?cmts.map((c,ci)=>(<div key={ci} style={{display:"flex",gap:"10px",marginBottom:"12px"}}><div style={{width:"28px",height:"28px",borderRadius:"50%",overflow:"hidden",background:c.avatar?"none":(c.uid===uid?"linear-gradient(135deg,#FF6B35,#A855F7)":"rgba(255,255,255,0.08)"),display:"flex",alignItems:"center",justifyContent:"center",fontSize:"12px",flexShrink:0,color:"#fff",fontWeight:700}}>{c.avatar?<img src={c.avatar} style={{width:"100%",height:"100%",objectFit:"cover"}}/>:(c.displayName||c.username||"?")[0].toUpperCase()}</div><div style={{flex:1}}><div style={{display:"flex",alignItems:"center",gap:"6px"}}><span style={{color:"#fff",fontSize:"12px",fontWeight:600}}>{c.displayName||c.username}</span>{c.username&&<span style={{color:"rgba(255,255,255,0.2)",fontSize:"10px"}}>@{c.username}</span>}<span style={{color:"rgba(255,255,255,0.25)",fontSize:"10px"}}>{timeAgo(c.createdAt)}</span>{c.uid===uid&&<button onClick={()=>handleDeleteComment(post.id,c.id)} style={{background:"none",border:"none",color:"rgba(255,255,255,0.2)",fontSize:"12px",cursor:"pointer",padding:"0 4px"}}>ğŸ—‘ï¸</button>}</div><p style={{color:"rgba(255,255,255,0.5)",fontSize:"13px",lineHeight:1.5,margin:"4px 0 0"}}>{c.text}</p></div></div>)):(<p style={{color:"rgba(255,255,255,0.25)",fontSize:"13px",textAlign:"center",margin:"8px 0"}}>Ä°lk yorumu sen yaz!</p>)}<div style={{display:"flex",gap:"8px",marginTop:"8px"}}><input type="text" placeholder="Yorum yaz..." value={newComment} onChange={e=>setNewComment(e.target.value)} onKeyDown={e=>e.key==="Enter"&&handleComment(post.id)} style={{flex:1,padding:"10px 14px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"#fff",fontSize:"13px",outline:"none",boxSizing:"border-box"}}/><button onClick={()=>handleComment(post.id)} style={{padding:"10px 16px",borderRadius:"12px",border:"none",background:newComment.trim()?"linear-gradient(135deg,#3B82F6,#2563EB)":"rgba(255,255,255,0.06)",color:newComment.trim()?"#fff":"rgba(255,255,255,0.2)",fontSize:"13px",fontWeight:600,cursor:newComment.trim()?"pointer":"default"}}>GÃ¶nder</button></div></div>)}</Glass>)})}<button onClick={loadPosts} style={{padding:"12px",borderRadius:"14px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.5)",fontSize:"13px",fontWeight:600,cursor:"pointer",marginTop:"4px"}}>ğŸ”„ Yenile</button></div>)}
export default function App(){const[authUser,setAuthUser]=useState(undefined);const[profile,setProfile]=useState(null);const[state,setState]=useState(()=>storage.get("wanderly-state")||DEFAULT_STATE);const[tab,setTab]=useState("today");const[completed,setCompleted]=useState(false);const[envChoice,setEnvChoice]=useState(null);const[lightboxPhoto,setLightboxPhoto]=useState(null);const[profileLoading,setProfileLoading]=useState(true);const saveState=useCallback((ns)=>{setState(ns);storage.set("wanderly-state",ns)},[]);useEffect(()=>{const unsub=onAuthChange(async(user)=>{setAuthUser(user);if(user){const p=await getUserProfile(user.uid);setProfile(p);setProfileLoading(false)}else{setProfile(null);setProfileLoading(false)}});return unsub},[]);useEffect(()=>{if(authUser&&profile&&state.onboarded&&state.todayDate!==getToday()){setEnvChoice(null);saveState({...state,todayAdventure:null,todayDate:null,skipsToday:0})}},[authUser,profile,state.onboarded]);const handleAuth=async(uid,googleName)=>{const p=await getUserProfile(uid);if(p)setProfile(p)};const handleProfileComplete=({username,displayName,avatar})=>{setProfile({username,displayName,avatar})};const handleOnboardComplete=({interests,difficulty,locationEnabled,city,lat,lon,nearbyPlaces})=>{saveState({...DEFAULT_STATE,interests,difficulty,locationEnabled,city,lat,lon,nearbyPlaces,onboarded:true,todayAdventure:null,todayDate:null})};const handleComplete=async(note,photo)=>{const adv=state.todayAdventure;const today=getToday();const yesterday=new Date(Date.now()-86400000).toISOString().split("T")[0];let ns=state.lastCompletedDate===yesterday?state.streak+1:1;let xp=state.xp+adv.xp,lv=state.level;while(xp>=xpForLevel(lv)){xp-=xpForLevel(lv);lv++}saveState({...state,xp,level:lv,streak:ns,bestStreak:Math.max(state.bestStreak,ns),completedAdventures:[...state.completedAdventures,{...adv,date:today,note,photo:photo||null}],lastCompletedDate:today,locationAdventureCount:(state.locationAdventureCount||0)+(adv.isLocation?1:0)});setCompleted(true);if(note&&note.trim()&&profile){const uid=getCurrentUid();if(uid)shareAdventure({uid,username:profile.username,displayName:profile.displayName,avatar:profile.avatar,title:adv.title,category:adv.category,note:note.trim(),photo,isLocation:adv.isLocation||false})}};const handleSkip=()=>{const skips=state.skipsToday||0;if(skips>=2)return;const ct=state.completedAdventures.map(a=>a.title).concat([state.todayAdventure?.title]);const adv=getRandomAdventure(state.interests,state.difficulty,ct,state.nearbyPlaces,state.locationEnabled,envChoice);saveState({...state,todayAdventure:adv,skipsToday:skips+1})};const toggleLocation=async()=>{if(state.locationEnabled){saveState({...state,locationEnabled:false,city:null,nearbyPlaces:[],lat:null,lon:null})}else if(navigator.geolocation){navigator.geolocation.getCurrentPosition(async(pos)=>{const lt=pos.coords.latitude,ln=pos.coords.longitude;let cn="Konum alÄ±ndÄ±";try{const res=await fetch(`https://nominatim.openstreetmap.org/reverse?lat=${lt}&lon=${ln}&format=json&accept-language=tr`);const data=await res.json();cn=data.address?.city||data.address?.town||data.address?.province||cn}catch{}const places=await fetchNearbyPlaces(lt,ln);saveState({...state,locationEnabled:true,city:cn,lat:lt,lon:ln,nearbyPlaces:places})},()=>{})}};const handleLogout=async()=>{if(window.confirm("Ã‡Ä±kÄ±ÅŸ yapmak istediÄŸine emin misin?")){await logoutUser();setProfile(null);setAuthUser(null)}};const handleAvatarUpdate=async(e)=>{const f=e.target.files[0];if(!f||!authUser)return;const r=new FileReader();r.onload=async(ev)=>{const img=new Image();img.onload=async()=>{const c=document.createElement("canvas");c.width=150;c.height=150;const ctx=c.getContext("2d");const s=Math.min(img.width,img.height);const sx=(img.width-s)/2;const sy=(img.height-s)/2;ctx.drawImage(img,sx,sy,s,s,0,0,150,150);const avatar=c.toDataURL("image/jpeg",0.7);await updateUserProfile(authUser.uid,{avatar});setProfile(prev=>({...prev,avatar}))};img.src=ev.target.result};r.readAsDataURL(f)};if(authUser===undefined||profileLoading)return(<><AnimatedBg/><div style={{minHeight:"100vh",display:"flex",alignItems:"center",justifyContent:"center",position:"relative",zIndex:1}}><div style={{color:"rgba(255,255,255,0.5)",fontSize:"18px",animation:"pulse 1.5s infinite"}}><style>{`@keyframes pulse{0%,100%{opacity:1}50%{opacity:0.3}}`}</style>ğŸŒ YÃ¼kleniyor...</div></div></>);if(!authUser)return(<><AnimatedBg/><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/><style>{`*{margin:0;padding:0;box-sizing:border-box;font-family:'DM Sans',sans-serif}@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}`}</style><AuthScreen onAuth={handleAuth}/></>);if(!profile)return(<><AnimatedBg/><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/><style>{`*{margin:0;padding:0;box-sizing:border-box;font-family:'DM Sans',sans-serif}@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}`}</style><ProfileSetup uid={authUser.uid} initialName={authUser.displayName||""} onComplete={handleProfileComplete}/></>);if(!state.onboarded)return(<><AnimatedBg/><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/><style>{`*{margin:0;padding:0;box-sizing:border-box;font-family:'DM Sans',sans-serif}@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}`}</style><Onboarding onComplete={handleOnboardComplete}/></>);const done=state.lastCompletedDate===getToday()||completed;const TABS=[{id:"today",label:"BugÃ¼n",emoji:"âš¡"},{id:"community",label:"Topluluk",emoji:"ğŸ’¬"},{id:"stats",label:"Ä°statistik",emoji:"ğŸ“Š"},{id:"history",label:"GeÃ§miÅŸ",emoji:"ğŸ“œ"},{id:"settings",label:"Ayarlar",emoji:"âš™ï¸"}];return(<>{lightboxPhoto&&<PhotoLightbox src={lightboxPhoto} onClose={()=>setLightboxPhoto(null)}/>}<AnimatedBg/><link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;600;700&family=DM+Sans:wght@400;500;600;700&display=swap" rel="stylesheet"/><style>{`*{margin:0;padding:0;box-sizing:border-box;font-family:'DM Sans',sans-serif}@keyframes fadeUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}`}</style><div style={{position:"relative",zIndex:1,minHeight:"100vh",display:"flex",flexDirection:"column",alignItems:"center",padding:"20px 16px 100px",width:"100%"}}><div style={{width:"100%",maxWidth:"480px",display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"24px"}}><div style={{display:"flex",alignItems:"center",gap:"12px"}}><div style={{width:"38px",height:"38px",borderRadius:"50%",overflow:"hidden",background:profile.avatar?"none":"linear-gradient(135deg,#FF6B35,#A855F7)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid rgba(255,255,255,0.15)",flexShrink:0}}>{profile.avatar?<img src={profile.avatar} style={{width:"100%",height:"100%",objectFit:"cover"}}/>:<span style={{color:"#fff",fontSize:"14px",fontWeight:700}}>{profile.displayName[0].toUpperCase()}</span>}</div><div><h1 style={{fontFamily:"'Playfair Display',Georgia,serif",fontSize:"22px",fontWeight:700,color:"#fff"}}>Wanderly</h1><p style={{color:"rgba(255,255,255,0.4)",fontSize:"12px",marginTop:"1px"}}>@{profile.username}{state.city&&<span style={{marginLeft:"6px"}}>ğŸ“ {state.city}</span>}</p></div></div><div style={{background:"linear-gradient(135deg,#FF6B3520,#A855F720)",padding:"8px 16px",borderRadius:"20px",display:"flex",alignItems:"center",gap:"6px"}}><span style={{fontSize:"14px"}}>â­</span><span style={{color:"#FF6B35",fontSize:"14px",fontWeight:700}}>Lv.{state.level}</span></div></div><div style={{display:"flex",gap:"4px",marginBottom:"24px",background:"rgba(255,255,255,0.04)",padding:"4px",borderRadius:"14px",maxWidth:"480px",width:"100%"}}>{TABS.map(t=>(<button key={t.id} onClick={()=>setTab(t.id)} style={{flex:1,padding:"10px 6px",borderRadius:"10px",border:"none",background:tab===t.id?"rgba(255,255,255,0.1)":"transparent",color:tab===t.id?"#fff":"rgba(255,255,255,0.4)",fontSize:"12px",fontWeight:600,cursor:"pointer"}}>{t.emoji} {t.label}</button>))}</div>{tab==="today"&&(<div style={{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}}>{done?(<Glass style={{padding:"40px 24px",textAlign:"center",maxWidth:"480px",width:"100%",animation:"fadeUp 0.5s ease"}}><div style={{fontSize:"56px",marginBottom:"16px"}}>ğŸ‰</div><h2 style={{color:"#fff",fontSize:"22px",fontWeight:700,marginBottom:"8px",fontFamily:"'Playfair Display',Georgia,serif"}}>BugÃ¼nkÃ¼ macera tamam!</h2><p style={{color:"rgba(255,255,255,0.45)",fontSize:"14px",marginBottom:"24px"}}>Harika iÅŸ!{state.streak>1&&` ${state.streak} gÃ¼nlÃ¼k seri ğŸ”¥`}</p><button onClick={()=>{setCompleted(false);setEnvChoice(null);saveState({...state,todayAdventure:null,lastCompletedDate:null})}} style={{padding:"12px 28px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.15)",background:"rgba(255,255,255,0.06)",color:"rgba(255,255,255,0.7)",fontSize:"14px",fontWeight:600,cursor:"pointer"}}>ğŸ² Bonus macera iste</button></Glass>):!state.todayAdventure?(<Glass style={{padding:"32px 24px",textAlign:"center",maxWidth:"480px",width:"100%",animation:"fadeUp 0.5s ease"}}><div style={{fontSize:"40px",marginBottom:"12px"}}>ğŸ—ºï¸</div><h2 style={{color:"#fff",fontSize:"20px",fontWeight:700,marginBottom:"6px",fontFamily:"'Playfair Display',Georgia,serif"}}>BugÃ¼n nerede macera yapmak istersin?</h2><p style={{color:"rgba(255,255,255,0.4)",fontSize:"13px",marginBottom:"20px"}}>Sana uygun gÃ¶rev verelim</p><div style={{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"10px"}}>{ENVIRONMENTS.map(e=>(<button key={e.id} onClick={()=>{setEnvChoice(e.id);const ct=state.completedAdventures.map(a=>a.title);const adv=getRandomAdventure(state.interests,state.difficulty,ct,state.nearbyPlaces,state.locationEnabled,e.id);saveState({...state,todayAdventure:adv,todayDate:getToday(),skipsToday:0})}} style={{padding:"18px 12px",borderRadius:"14px",border:"2px solid rgba(255,255,255,0.08)",background:"rgba(255,255,255,0.03)",cursor:"pointer",textAlign:"center"}}><div style={{fontSize:"30px",marginBottom:"8px"}}>{e.emoji}</div><div style={{color:"#fff",fontSize:"14px",fontWeight:600}}>{e.label}</div><div style={{color:"rgba(255,255,255,0.35)",fontSize:"11px",marginTop:"4px"}}>{e.desc}</div></button>))}</div></Glass>):<AdventureCard adventure={state.todayAdventure} onComplete={handleComplete} onSkip={handleSkip} skipsLeft={2-(state.skipsToday||0)}/>}</div>)}{tab==="community"&&<div style={{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",maxWidth:"480px"}}><Community state={state} profile={profile} onPhotoClick={setLightboxPhoto}/></div>}{tab==="stats"&&<div style={{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}}><StatsPanel state={state}/></div>}{tab==="history"&&<div style={{display:"flex",flexDirection:"column",alignItems:"center",width:"100%"}}><History adventures={state.completedAdventures} onPhotoClick={setLightboxPhoto}/></div>}{tab==="settings"&&(<div style={{display:"flex",flexDirection:"column",alignItems:"center",width:"100%",gap:"12px",maxWidth:"480px"}}><Glass style={{padding:"24px",width:"100%",animation:"fadeUp 0.5s ease"}}><h2 style={{color:"#fff",fontSize:"18px",fontWeight:700,marginBottom:"20px"}}>âš™ï¸ Ayarlar</h2><div style={{display:"flex",alignItems:"center",gap:"16px",padding:"16px",borderRadius:"14px",background:"rgba(255,255,255,0.03)",marginBottom:"20px"}}><label style={{cursor:"pointer"}}><div style={{width:"56px",height:"56px",borderRadius:"50%",overflow:"hidden",background:profile.avatar?"none":"linear-gradient(135deg,#FF6B35,#A855F7)",display:"flex",alignItems:"center",justifyContent:"center",border:"2px solid rgba(255,255,255,0.15)"}}>{profile.avatar?<img src={profile.avatar} style={{width:"100%",height:"100%",objectFit:"cover"}}/>:<span style={{color:"#fff",fontSize:"22px"}}>{profile.displayName[0].toUpperCase()}</span>}</div><input type="file" accept="image/*" style={{display:"none"}} onChange={handleAvatarUpdate}/></label><div style={{flex:1}}><div style={{color:"#fff",fontSize:"15px",fontWeight:600}}>{profile.displayName}</div><div style={{color:"rgba(255,255,255,0.4)",fontSize:"12px"}}>@{profile.username}</div><div style={{color:"rgba(255,255,255,0.25)",fontSize:"11px",marginTop:"2px"}}>FotoÄŸrafa tÄ±klayarak deÄŸiÅŸtir</div></div></div><div style={{marginBottom:"20px"}}><div style={{color:"rgba(255,255,255,0.5)",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"12px"}}>Konum</div><div style={{padding:"14px 16px",borderRadius:"12px",background:"rgba(255,255,255,0.03)"}}><div style={{display:"flex",justifyContent:"space-between",alignItems:"center"}}><div><div style={{color:"#fff",fontSize:"14px",fontWeight:600}}>ğŸ“ Konum bazlÄ± maceralar</div><div style={{color:"rgba(255,255,255,0.35)",fontSize:"12px",marginTop:"4px"}}>{state.locationEnabled?`${state.city||"Aktif"} â€” ${(state.nearbyPlaces||[]).length} mekan`:"KapalÄ±"}</div></div><button onClick={toggleLocation} style={{padding:"8px 16px",borderRadius:"20px",border:"none",background:state.locationEnabled?"rgba(16,185,129,0.2)":"rgba(255,255,255,0.1)",color:state.locationEnabled?"#10B981":"rgba(255,255,255,0.5)",fontSize:"13px",fontWeight:600,cursor:"pointer"}}>{state.locationEnabled?"AÃ§Ä±k âœ“":"AÃ§"}</button></div></div></div><div style={{marginBottom:"20px"}}><div style={{color:"rgba(255,255,255,0.5)",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"12px"}}>Zorluk</div><div style={{display:"flex",gap:"8px"}}>{DIFFICULTY_LEVELS.map(d=>(<button key={d.id} onClick={()=>saveState({...state,difficulty:d.id})} style={{flex:1,padding:"10px 8px",borderRadius:"12px",border:`2px solid ${state.difficulty===d.id?"#FF6B35":"rgba(255,255,255,0.08)"}`,background:state.difficulty===d.id?"rgba(255,107,53,0.1)":"rgba(255,255,255,0.02)",color:state.difficulty===d.id?"#FF6B35":"rgba(255,255,255,0.5)",fontSize:"13px",fontWeight:600,cursor:"pointer"}}>{d.emoji} {d.label}</button>))}</div></div><div style={{marginBottom:"20px"}}><div style={{color:"rgba(255,255,255,0.5)",fontSize:"12px",fontWeight:600,textTransform:"uppercase",letterSpacing:"1px",marginBottom:"12px"}}>Kategoriler</div><div style={{display:"grid",gridTemplateColumns:"1fr 1fr 1fr",gap:"8px"}}>{CATEGORIES.map(cat=>{const sel=state.interests.includes(cat.id);return(<button key={cat.id} onClick={()=>{const ni=sel?state.interests.filter(x=>x!==cat.id):[...state.interests,cat.id];if(ni.length>=2)saveState({...state,interests:ni})}} style={{padding:"10px 6px",borderRadius:"10px",border:`2px solid ${sel?cat.color:"rgba(255,255,255,0.08)"}`,background:sel?`${cat.color}18`:"rgba(255,255,255,0.02)",color:sel?cat.color:"rgba(255,255,255,0.4)",fontSize:"12px",fontWeight:600,cursor:"pointer"}}>{cat.emoji} {cat.label}</button>)})}</div><div style={{color:"rgba(255,255,255,0.25)",fontSize:"11px",marginTop:"6px"}}>En az 2 kategori seÃ§ili olmalÄ±</div></div><div style={{borderTop:"1px solid rgba(255,255,255,0.06)",paddingTop:"16px",display:"flex",flexDirection:"column",gap:"10px"}}><button onClick={handleLogout} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(255,255,255,0.1)",background:"rgba(255,255,255,0.04)",color:"rgba(255,255,255,0.5)",fontSize:"13px",fontWeight:600,cursor:"pointer"}}>ğŸšª Ã‡Ä±kÄ±ÅŸ Yap</button><button onClick={()=>{if(window.confirm("TÃ¼m yerel veriler silinecek. Emin misin?")){localStorage.clear();window.location.reload()}}} style={{width:"100%",padding:"12px",borderRadius:"12px",border:"1px solid rgba(239,68,68,0.3)",background:"rgba(239,68,68,0.08)",color:"#EF4444",fontSize:"13px",fontWeight:600,cursor:"pointer"}}>ğŸ—‘ï¸ Yerel verileri sÄ±fÄ±rla</button></div></Glass></div>)}</div></>)}
